version: 0.2

env:
  variables:
    CACHE_CONTROL: "100"
    S3_BUCKET: dev-artifacts-114838604208

phases:
  build:
    commands:
      - echo Entered the build phase...
      - aws s3 cp ./templates/pipeline.yaml s3://${S3_BUCKET}/deploys/project/pipeline.yaml

  post_build:
    commands:
      - for t in $(ls "templates")
          do
            aws cloudformation package --template-file ./templates/$t --s3-bucket ${S3_BUCKET} --output-template-file ./templates/$t --s3-prefix deploys/project
            if [ "${t}" != "MasterTemplate.json" ]
            then
              aws s3 cp ./templates/$t s3://${S3_BUCKET}/deploys/project/$t
            fi
          done

artifacts:
   files:
     - '**/*'
